	.text
	.p2align	5
	.globl	_chacha20_ref
	.globl	chacha20_ref
_chacha20_ref:
chacha20_ref:
	pushq	%rbp
	pushq	%rbx
	pushq	%r12
	pushq	%r13
	pushq	%r14
	pushq	%r15
	subq	$96, %rsp
	movq	%rdi, 8(%rsp)
	movq	%rsi, (%rsp)
	movl	%edx, 92(%rsp)
	movl	$1634760805, 16(%rsp)
	movl	$857760878, 20(%rsp)
	movl	$2036477234, 24(%rsp)
	movl	$1797285236, 28(%rsp)
	movl	(%rcx), %eax
	movl	%eax, 32(%rsp)
	movl	4(%rcx), %eax
	movl	%eax, 36(%rsp)
	movl	8(%rcx), %eax
	movl	%eax, 40(%rsp)
	movl	12(%rcx), %eax
	movl	%eax, 44(%rsp)
	movl	16(%rcx), %eax
	movl	%eax, 48(%rsp)
	movl	20(%rcx), %eax
	movl	%eax, 52(%rsp)
	movl	24(%rcx), %eax
	movl	%eax, 56(%rsp)
	movl	28(%rcx), %eax
	movl	%eax, 60(%rsp)
	movl	%r9d, 64(%rsp)
	movl	(%r8), %eax
	movl	%eax, 68(%rsp)
	movl	4(%r8), %eax
	movl	%eax, 72(%rsp)
	movl	8(%r8), %eax
	movl	%eax, 76(%rsp)
	jmp 	Lchacha20_ref$7
Lchacha20_ref$8:
	movl	76(%rsp), %eax
	movl	%eax, 80(%rsp)
	movl	16(%rsp), %eax
	movl	20(%rsp), %ecx
	movl	24(%rsp), %edx
	movl	28(%rsp), %esi
	movl	32(%rsp), %edi
	movl	36(%rsp), %r8d
	movl	40(%rsp), %r9d
	movl	44(%rsp), %r10d
	movl	48(%rsp), %r11d
	movl	52(%rsp), %ebp
	movl	56(%rsp), %ebx
	movl	60(%rsp), %r12d
	movl	64(%rsp), %r13d
	movl	68(%rsp), %r14d
	movl	72(%rsp), %r15d
	movl	$10, 84(%rsp)
Lchacha20_ref$9:
	addl	%edi, %eax
	addl	%r9d, %edx
	xorl	%eax, %r13d
	xorl	%edx, %r15d
	roll	$16, %r13d
	roll	$16, %r15d
	addl	%r13d, %r11d
	addl	%r15d, %ebx
	xorl	%r11d, %edi
	xorl	%ebx, %r9d
	roll	$12, %edi
	roll	$12, %r9d
	addl	%edi, %eax
	addl	%r9d, %edx
	xorl	%eax, %r13d
	xorl	%edx, %r15d
	roll	$8, %r13d
	roll	$8, %r15d
	addl	%r13d, %r11d
	addl	%r15d, %ebx
	xorl	%r11d, %edi
	xorl	%ebx, %r9d
	roll	$7, %edi
	roll	$7, %r9d
	movl	%r15d, 88(%rsp)
	movl	80(%rsp), %r15d
	addl	%r8d, %ecx
	addl	%r10d, %esi
	xorl	%ecx, %r14d
	xorl	%esi, %r15d
	roll	$16, %r14d
	roll	$16, %r15d
	addl	%r14d, %ebp
	addl	%r15d, %r12d
	xorl	%ebp, %r8d
	xorl	%r12d, %r10d
	roll	$12, %r8d
	roll	$12, %r10d
	addl	%r8d, %ecx
	addl	%r10d, %esi
	xorl	%ecx, %r14d
	xorl	%esi, %r15d
	roll	$8, %r14d
	roll	$8, %r15d
	addl	%r14d, %ebp
	addl	%r15d, %r12d
	xorl	%ebp, %r8d
	xorl	%r12d, %r10d
	roll	$7, %r8d
	roll	$7, %r10d
	addl	%r9d, %ecx
	addl	%r8d, %eax
	xorl	%ecx, %r13d
	xorl	%eax, %r15d
	roll	$16, %r13d
	roll	$16, %r15d
	addl	%r13d, %r12d
	addl	%r15d, %ebx
	xorl	%r12d, %r9d
	xorl	%ebx, %r8d
	roll	$12, %r9d
	roll	$12, %r8d
	addl	%r9d, %ecx
	addl	%r8d, %eax
	xorl	%ecx, %r13d
	xorl	%eax, %r15d
	roll	$8, %r13d
	roll	$8, %r15d
	addl	%r13d, %r12d
	addl	%r15d, %ebx
	xorl	%r12d, %r9d
	xorl	%ebx, %r8d
	roll	$7, %r9d
	roll	$7, %r8d
	movl	%r15d, 80(%rsp)
	movl	88(%rsp), %r15d
	addl	%r10d, %edx
	addl	%edi, %esi
	xorl	%edx, %r14d
	xorl	%esi, %r15d
	roll	$16, %r14d
	roll	$16, %r15d
	addl	%r14d, %r11d
	addl	%r15d, %ebp
	xorl	%r11d, %r10d
	xorl	%ebp, %edi
	roll	$12, %r10d
	roll	$12, %edi
	addl	%r10d, %edx
	addl	%edi, %esi
	xorl	%edx, %r14d
	xorl	%esi, %r15d
	roll	$8, %r14d
	roll	$8, %r15d
	addl	%r14d, %r11d
	addl	%r15d, %ebp
	xorl	%r11d, %r10d
	xorl	%ebp, %edi
	roll	$7, %r10d
	roll	$7, %edi
	decl	84(%rsp)
	jne 	Lchacha20_ref$9
	addl	20(%rsp), %ecx
	addl	16(%rsp), %eax
	movl	%ecx, %ecx
	shlq	$32, %rcx
	movl	%eax, %eax
	xorq	%rax, %rcx
	movq	(%rsp), %rax
	xorq	(%rax), %rcx
	addl	28(%rsp), %esi
	addl	24(%rsp), %edx
	movl	%esi, %esi
	shlq	$32, %rsi
	movl	%edx, %edx
	xorq	%rdx, %rsi
	xorq	8(%rax), %rsi
	movq	8(%rsp), %rdx
	movq	%rcx, (%rdx)
	addl	36(%rsp), %r8d
	addl	32(%rsp), %edi
	movl	%r8d, %ecx
	shlq	$32, %rcx
	movl	%edi, %edi
	xorq	%rdi, %rcx
	xorq	16(%rax), %rcx
	movq	%rsi, 8(%rdx)
	addl	44(%rsp), %r10d
	addl	40(%rsp), %r9d
	movl	%r10d, %esi
	shlq	$32, %rsi
	movl	%r9d, %edi
	xorq	%rdi, %rsi
	xorq	24(%rax), %rsi
	movq	%rcx, 16(%rdx)
	addl	52(%rsp), %ebp
	addl	48(%rsp), %r11d
	movl	%ebp, %ecx
	shlq	$32, %rcx
	movl	%r11d, %edi
	xorq	%rdi, %rcx
	xorq	32(%rax), %rcx
	movq	%rsi, 24(%rdx)
	addl	60(%rsp), %r12d
	addl	56(%rsp), %ebx
	movl	%r12d, %esi
	shlq	$32, %rsi
	movl	%ebx, %edi
	xorq	%rdi, %rsi
	xorq	40(%rax), %rsi
	movq	%rcx, 32(%rdx)
	addl	68(%rsp), %r14d
	addl	64(%rsp), %r13d
	movl	%r14d, %ecx
	shlq	$32, %rcx
	movl	%r13d, %edi
	xorq	%rdi, %rcx
	xorq	48(%rax), %rcx
	movq	%rsi, 40(%rdx)
	movl	80(%rsp), %esi
	addl	76(%rsp), %esi
	addl	72(%rsp), %r15d
	movl	%esi, %esi
	shlq	$32, %rsi
	movl	%r15d, %edi
	xorq	%rdi, %rsi
	xorq	56(%rax), %rsi
	movq	%rcx, 48(%rdx)
	movq	%rsi, 56(%rdx)
	movl	92(%rsp), %ecx
	addq	$64, %rdx
	addq	$64, %rax
	subl	$64, %ecx
	movq	%rdx, 8(%rsp)
	movq	%rax, (%rsp)
	movl	%ecx, 92(%rsp)
	movl	$1, %eax
	addl	64(%rsp), %eax
	movl	%eax, 64(%rsp)
Lchacha20_ref$7:
	cmpl	$64, 92(%rsp)
	jnb 	Lchacha20_ref$8
	cmpl	$0, 92(%rsp)
	jbe 	Lchacha20_ref$1
	movl	76(%rsp), %eax
	movl	%eax, 80(%rsp)
	movl	16(%rsp), %eax
	movl	20(%rsp), %ecx
	movl	24(%rsp), %edx
	movl	28(%rsp), %esi
	movl	32(%rsp), %edi
	movl	36(%rsp), %r8d
	movl	40(%rsp), %r9d
	movl	44(%rsp), %r10d
	movl	48(%rsp), %r11d
	movl	52(%rsp), %ebp
	movl	56(%rsp), %ebx
	movl	60(%rsp), %r12d
	movl	64(%rsp), %r13d
	movl	68(%rsp), %r14d
	movl	72(%rsp), %r15d
	movl	$10, 84(%rsp)
Lchacha20_ref$6:
	addl	%edi, %eax
	addl	%r9d, %edx
	xorl	%eax, %r13d
	xorl	%edx, %r15d
	roll	$16, %r13d
	roll	$16, %r15d
	addl	%r13d, %r11d
	addl	%r15d, %ebx
	xorl	%r11d, %edi
	xorl	%ebx, %r9d
	roll	$12, %edi
	roll	$12, %r9d
	addl	%edi, %eax
	addl	%r9d, %edx
	xorl	%eax, %r13d
	xorl	%edx, %r15d
	roll	$8, %r13d
	roll	$8, %r15d
	addl	%r13d, %r11d
	addl	%r15d, %ebx
	xorl	%r11d, %edi
	xorl	%ebx, %r9d
	roll	$7, %edi
	roll	$7, %r9d
	movl	%r15d, 88(%rsp)
	movl	80(%rsp), %r15d
	addl	%r8d, %ecx
	addl	%r10d, %esi
	xorl	%ecx, %r14d
	xorl	%esi, %r15d
	roll	$16, %r14d
	roll	$16, %r15d
	addl	%r14d, %ebp
	addl	%r15d, %r12d
	xorl	%ebp, %r8d
	xorl	%r12d, %r10d
	roll	$12, %r8d
	roll	$12, %r10d
	addl	%r8d, %ecx
	addl	%r10d, %esi
	xorl	%ecx, %r14d
	xorl	%esi, %r15d
	roll	$8, %r14d
	roll	$8, %r15d
	addl	%r14d, %ebp
	addl	%r15d, %r12d
	xorl	%ebp, %r8d
	xorl	%r12d, %r10d
	roll	$7, %r8d
	roll	$7, %r10d
	addl	%r9d, %ecx
	addl	%r8d, %eax
	xorl	%ecx, %r13d
	xorl	%eax, %r15d
	roll	$16, %r13d
	roll	$16, %r15d
	addl	%r13d, %r12d
	addl	%r15d, %ebx
	xorl	%r12d, %r9d
	xorl	%ebx, %r8d
	roll	$12, %r9d
	roll	$12, %r8d
	addl	%r9d, %ecx
	addl	%r8d, %eax
	xorl	%ecx, %r13d
	xorl	%eax, %r15d
	roll	$8, %r13d
	roll	$8, %r15d
	addl	%r13d, %r12d
	addl	%r15d, %ebx
	xorl	%r12d, %r9d
	xorl	%ebx, %r8d
	roll	$7, %r9d
	roll	$7, %r8d
	movl	%r15d, 80(%rsp)
	movl	88(%rsp), %r15d
	addl	%r10d, %edx
	addl	%edi, %esi
	xorl	%edx, %r14d
	xorl	%esi, %r15d
	roll	$16, %r14d
	roll	$16, %r15d
	addl	%r14d, %r11d
	addl	%r15d, %ebp
	xorl	%r11d, %r10d
	xorl	%ebp, %edi
	roll	$12, %r10d
	roll	$12, %edi
	addl	%r10d, %edx
	addl	%edi, %esi
	xorl	%edx, %r14d
	xorl	%esi, %r15d
	roll	$8, %r14d
	roll	$8, %r15d
	addl	%r14d, %r11d
	addl	%r15d, %ebp
	xorl	%r11d, %r10d
	xorl	%ebp, %edi
	roll	$7, %r10d
	roll	$7, %edi
	decl	84(%rsp)
	jne 	Lchacha20_ref$6
	addl	16(%rsp), %eax
	addl	20(%rsp), %ecx
	addl	24(%rsp), %edx
	addl	28(%rsp), %esi
	addl	32(%rsp), %edi
	addl	36(%rsp), %r8d
	addl	40(%rsp), %r9d
	addl	44(%rsp), %r10d
	addl	48(%rsp), %r11d
	addl	52(%rsp), %ebp
	addl	56(%rsp), %ebx
	addl	60(%rsp), %r12d
	addl	64(%rsp), %r13d
	addl	68(%rsp), %r14d
	addl	72(%rsp), %r15d
	movl	%r15d, 88(%rsp)
	movl	80(%rsp), %r15d
	addl	76(%rsp), %r15d
	movl	%r15d, 84(%rsp)
	movl	88(%rsp), %r15d
	movl	%eax, 16(%rsp)
	movl	%ecx, 20(%rsp)
	movl	%edx, 24(%rsp)
	movl	%esi, 28(%rsp)
	movl	%edi, 32(%rsp)
	movl	%r8d, 36(%rsp)
	movl	%r9d, 40(%rsp)
	movl	%r10d, 44(%rsp)
	movl	%r11d, 48(%rsp)
	movl	%ebp, 52(%rsp)
	movl	%ebx, 56(%rsp)
	movl	%r12d, 60(%rsp)
	movl	%r13d, 64(%rsp)
	movl	%r14d, 68(%rsp)
	movl	%r15d, 72(%rsp)
	movl	84(%rsp), %eax
	movl	%eax, 76(%rsp)
	movq	8(%rsp), %rax
	movq	(%rsp), %rcx
	movl	92(%rsp), %edx
	movl	%edx, %esi
	shrl	$3, %esi
	movq	$0, %rdi
	jmp 	Lchacha20_ref$4
Lchacha20_ref$5:
	movq	(%rcx,%rdi,8), %r8
	xorq	16(%rsp,%rdi,8), %r8
	movq	%r8, (%rax,%rdi,8)
	incq	%rdi
Lchacha20_ref$4:
	cmpl	%esi, %edi
	jb  	Lchacha20_ref$5
	shlq	$3, %rdi
	jmp 	Lchacha20_ref$2
Lchacha20_ref$3:
	movb	(%rcx,%rdi), %sil
	xorb	16(%rsp,%rdi), %sil
	movb	%sil, (%rax,%rdi)
	incq	%rdi
Lchacha20_ref$2:
	cmpl	%edx, %edi
	jb  	Lchacha20_ref$3
Lchacha20_ref$1:
	addq	$96, %rsp
	popq	%r15
	popq	%r14
	popq	%r13
	popq	%r12
	popq	%rbx
	popq	%rbp
	ret
